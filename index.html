<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OAuth Test Server</title>
  </head>
  <body>
    <h1>OAuth Test Server</h1>

    <h4>Step 1: Get Authorization URL</h4>
    <button id="getAuthURL">Get Auth URL</button>
    <p id="authURL"></p>

    <h4>Step 2: Retrieve Access Token</h4>
    <button id="getAccessToken">Get Access Token</button>
    <p id="accessToken"></p>

    <h4>Step 3: Get Calendar Events</h4>
    <button id="getEvents">Get Events</button>
    <p id="eventsList"></p>

    <script>
      const getAuthURL =
        "https://afbpzo8aj0.execute-api.us-east-1.amazonaws.com/dev/api/get-auth-url";
      const getAccessToken =
        "https://afbpzo8aj0.execute-api.us-east-1.amazonaws.com/dev/api/get-access-token";
      const getCalendarEvents =
        "https://afbpzo8aj0.execute-api.us-east-1.amazonaws.com/dev/api/get-events";

      document.getElementById("getAuthURL").onclick = function () {
        fetch(getAuthURL)
          .then((response) => response.json())
          .then((data) => {
            document.getElementById(
              "authURL"
            ).innerHTML = `<a href="${data.authUrl}" target="_blank">${data.authUrl}</a>`;
          });
      };

      document.getElementById("getAccessToken").onclick = function () {
        const code = prompt(
          "Enter the authorization code from the redirected URL:"
        );
        fetch(getAccessToken, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ code }),
        })
          .then((response) => response.json())
          .then((data) => {
            document.getElementById("accessToken").innerText =
              JSON.stringify(data);
          });
      };

      document.getElementById("getEvents").onclick = function () {
        const { access_token } = JSON.parse(
          document.getElementById("accessToken").innerText
        );
        fetch(`${getCalendarEvents}/${access_token}`)
          .then((response) => response.json())
          .then((data) => {
            const events = data.events
              .map(
                (event) => `<li>${event.summary} (${event.start.dateTime})</li>`
              )
              .join("");
            document.getElementById(
              "eventsList"
            ).innerHTML = `<ul>${events}</ul>`;
          });
      };
    </script>
  </body>
</html>
